name: PR Status Notifications

on:
  pull_request:
    types: [opened, closed, synchronized]
    branches:
      - main
  pull_request_review:
    types: [submitted]

jobs:
  notify-pr-status:
    runs-on: ubuntu-latest
    if: github.head_ref == 'develop' && github.base_ref == 'main'

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: PR Opened Notification
        if: github.event.action == 'opened'
        run: |
          echo "ğŸ‰ Novo PR criado: develop â†’ main"
          echo "ğŸ“‹ PR #${{ github.event.number }}: ${{ github.event.pull_request.title }}"
          echo "ğŸ‘¤ Criado por: @${{ github.event.pull_request.user.login }}"
          echo "ğŸ”— URL: ${{ github.event.pull_request.html_url }}"

          # Adicionar comentÃ¡rio automÃ¡tico com instruÃ§Ãµes
          gh pr comment ${{ github.event.number }} --body "## ğŸ¤– Auto-generated comment

          ### ğŸ“‹ Checklist de merge:
          - [ ] Code review completo
          - [ ] Todos os testes passando
          - [ ] DocumentaÃ§Ã£o atualizada
          - [ ] AprovaÃ§Ã£o de pelo menos 1 reviewer

          ### ğŸš€ Para fazer merge:
          1. Certifique-se que todos os checks estÃ£o passando
          2. Obtenha aprovaÃ§Ã£o dos reviewers necessÃ¡rios
          3. Use **Squash and merge** ou **Merge commit** conforme preferÃªncia do projeto

          *Este comentÃ¡rio foi gerado automaticamente*"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: PR Updated Notification
        if: github.event.action == 'synchronize'
        run: |
          echo "ğŸ”„ PR atualizado: develop â†’ main"
          echo "ğŸ“‹ PR #${{ github.event.number }}: ${{ github.event.pull_request.title }}"
          echo "ğŸ‘¤ Atualizado por: @${{ github.event.sender.login }}"

      - name: PR Merged Notification
        if: github.event.action == 'closed' && github.event.pull_request.merged == true
        run: |
          echo "âœ… PR merged com sucesso!"
          echo "ğŸ“‹ PR #${{ github.event.number }}: ${{ github.event.pull_request.title }}"
          echo "ğŸ‘¤ Merged por: @${{ github.event.pull_request.merged_by.login }}"

          # Opcional: criar tag de release
          echo "ğŸ·ï¸ Considerando criar uma tag de release..."

      - name: PR Closed Without Merge
        if: github.event.action == 'closed' && github.event.pull_request.merged == false
        run: |
          echo "âŒ PR fechado sem merge"
          echo "ğŸ“‹ PR #${{ github.event.number }}: ${{ github.event.pull_request.title }}"
          echo "ğŸ‘¤ Fechado por: @${{ github.event.sender.login }}"

      - name: Review Submitted
        if: github.event_name == 'pull_request_review'
        run: |
          echo "ğŸ“ Review submetido por @${{ github.event.review.user.login }}"
          echo "ğŸ¯ Estado: ${{ github.event.review.state }}"
          if [ "${{ github.event.review.state }}" = "approved" ]; then
            echo "âœ… PR aprovado!"
          elif [ "${{ github.event.review.state }}" = "changes_requested" ]; then
            echo "âš ï¸ MudanÃ§as solicitadas"
          fi
