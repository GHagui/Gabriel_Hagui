name: PR Status Notifications

on:
  pull_request:
    types: [opened, closed, synchronized]
    branches:
      - main
  pull_request_review:
    types: [submitted]

jobs:
  notify-pr-status:
    runs-on: ubuntu-latest
    if: github.head_ref == 'develop' && github.base_ref == 'main'

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: PR Opened Notification
        if: github.event.action == 'opened'
        run: |
          echo "🎉 Novo PR criado: develop → main"
          echo "📋 PR #${{ github.event.number }}: ${{ github.event.pull_request.title }}"
          echo "👤 Criado por: @${{ github.event.pull_request.user.login }}"
          echo "🔗 URL: ${{ github.event.pull_request.html_url }}"

          # Adicionar comentário automático com instruções
          gh pr comment ${{ github.event.number }} --body "## 🤖 Auto-generated comment

          ### 📋 Checklist de merge:
          - [ ] Code review completo
          - [ ] Todos os testes passando
          - [ ] Documentação atualizada
          - [ ] Aprovação de pelo menos 1 reviewer

          ### 🚀 Para fazer merge:
          1. Certifique-se que todos os checks estão passando
          2. Obtenha aprovação dos reviewers necessários
          3. Use **Squash and merge** ou **Merge commit** conforme preferência do projeto

          *Este comentário foi gerado automaticamente*"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: PR Updated Notification
        if: github.event.action == 'synchronize'
        run: |
          echo "🔄 PR atualizado: develop → main"
          echo "📋 PR #${{ github.event.number }}: ${{ github.event.pull_request.title }}"
          echo "👤 Atualizado por: @${{ github.event.sender.login }}"

      - name: PR Merged Notification
        if: github.event.action == 'closed' && github.event.pull_request.merged == true
        run: |
          echo "✅ PR merged com sucesso!"
          echo "📋 PR #${{ github.event.number }}: ${{ github.event.pull_request.title }}"
          echo "👤 Merged por: @${{ github.event.pull_request.merged_by.login }}"

          # Opcional: criar tag de release
          echo "🏷️ Considerando criar uma tag de release..."

      - name: PR Closed Without Merge
        if: github.event.action == 'closed' && github.event.pull_request.merged == false
        run: |
          echo "❌ PR fechado sem merge"
          echo "📋 PR #${{ github.event.number }}: ${{ github.event.pull_request.title }}"
          echo "👤 Fechado por: @${{ github.event.sender.login }}"

      - name: Review Submitted
        if: github.event_name == 'pull_request_review'
        run: |
          echo "📝 Review submetido por @${{ github.event.review.user.login }}"
          echo "🎯 Estado: ${{ github.event.review.state }}"
          if [ "${{ github.event.review.state }}" = "approved" ]; then
            echo "✅ PR aprovado!"
          elif [ "${{ github.event.review.state }}" = "changes_requested" ]; then
            echo "⚠️ Mudanças solicitadas"
          fi
